<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Simon Johnson">
    <title>..:: MQTT-SN ::..</title>

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/console/img/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/console/img/favicon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/console/img/favicon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/console/img/favicon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/console/img/favicon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/console/img/favicon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/console/img/favicon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/console/img/favicon/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/console/img/favicon/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/console/img/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/console/img/favicon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/console/img/favicon/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/console/img/favicon/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/console/img/favicon/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="/console/img/favicon/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="/console/img/favicon/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="/console/img/favicon/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="/console/img/favicon/mstile-310x310.png" />

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
    <script src="/console/js/autocomplete.js"></script>

    <link href="/console/css/style.css" rel="stylesheet">
    <link href="/console/css/ribbon.css" rel="stylesheet">
</head>
<body class="d-flex flex-column h-100">
<header></header>
<main class="flex-shrink-0">
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                    <div class="position-sticky pt-3">
                        <ul class="nav nav-pills flex-column">
                            <li class="nav-item" style="text-align: center">
                                <img src="/console/img/logo-no-background-round.png" alt="" height="180">
                            </li>
                            <hr>
                            <li class="nav-item" style="padding: 12px">
                                <form class="d-flex" role="search">
                                    <input class="form-control me-2" type="text" id="searchField" placeholder="Find sessions by clientId..." aria-label="Search" autocomplete="off" aria-describedby="basic-addon1">
                                </form>
                                <div id="searchHistory"></div>
                            </li>

                            <hr>
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#" id="dashboardLink">
                                    <span data-feather="activity"></span>
                                    Dashboard
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" id="clientsLink">
                                    <span data-feather="radio"></span>
                                   Client Access & Security
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" id="configLink">
                                    <span data-feather="edit"></span>
                                    Configuration
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" id="topicsLink">
                                    <span data-feather="hash"></span>
                                    Topics
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" id="connectorsLink">
                                    <span data-feather="package"></span>
                                    Connectors
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" id="settingsLink">
                                    <span data-feather="settings"></span>
                                    Settings
                                </a>
                            </li>

                            <hr>

                            <li class="nav-item">
                                <a class="nav-link cloud" href="#">
        <!--                            <span data-feather="cloud"></span>-->
                                    <img src="/console/img/cloud-logo-no-background.png" height="24"/>
                                    Mqtt-sn Cloud
                                </a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link disabled" href="#" id="clusterLink" disabled>
                                    <span data-feather="share-2"></span>
                                    Cluster
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link disabled" href="#" id="notificationsLink" disabled>
                                    <span data-feather="send"></span>
                                    Notifications
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link disabled" href="#" id="alarmsLink" disabled>
                                    <span data-feather="bell"></span>
                                    Alarms
                                </a>
                            </li>
                            <hr>
                            <li class="nav-item">
                                <a class="nav-link" href="#" id="docsLink">
                                    <span data-feather="file-text"></span>
                                    Documentation
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://github.com/simon622/mqtt-sn" id="" target="_blank">
                                    <span data-feather="github"></span>
                                    GitHub
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
                <div class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                    <div id="connectorStatus"></div>
                    <div style="margin-top: 20px;" id="messages"></div>
                    <div class="container align-items-center flex-wrap justify-content-between" style="margin-top: 20px;" id="dyna">
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script>

    var sessionId;
    var timerIds = [];

    bindClick('#dashboardLink', "dashboard.html", true);
    bindClick('#clientsLink', "clients.html");
    bindClick('#configLink', "config.html");
    bindClick('#topicsLink', "topics.html");
    bindClick('#clusterLink', "cluster.html");
    bindClick('#settingsLink', "settings.html");
    bindClick('#docsLink', "docs.html");
    bindClick('#connectorsLink', "connectors.html");
    bindClick('#systemLink', "system.html");

    function bindClick(selector, page, loadnow = false){
        $(selector).click(function() {
            clearTimers();
            $("#messages").html('');
            $.ajax({
                url: "/console/async?page=" + page,
                success: function( result ) {
                    $("#dyna").html(result);
                }
            });
            $('.nav li a').removeClass('active');
            $(this).toggleClass('active');
        });
        if(loadnow){
            $(selector).click();
        }
    }

    function updateHtmlElementTimerById(id, refreshRate){
        updateHtmlElementTimer(document.getElementById(id), refreshRate, true);
    }

    function updateHtmlElementTimer(el, refreshRate){
        pageTimer(refreshRate, false, function(){
            updateHtmlElement(el);
        });
    }

    function updateHtmlElementUrlTimerById(id, refreshRate, url){
        updateHtmlElementUrlTimer(document.getElementById(id), refreshRate, url, true);
    }

    function updateHtmlElementUrlTimerByIdGlobal(id, refreshRate, url){
        updateHtmlElementUrlTimer(document.getElementById(id), refreshRate, url, false);
    }

    function updateHtmlElementUrlTimer(el, refreshRate, url, track){
        pageTimer(refreshRate, track, function(){
            updateHtmlElementUrl(el, url);
        });
    }

    function pageTimer(refreshRate, track, f){
        var id = setInterval(f, refreshRate);
        if(track) timerIds.push(id);
    }

    function clearTimers(){
        timerIds.forEach(function(id) {
            clearInterval(id);
        });
        timerIds = [];
    }

    function updateHtmlElement(el){
        updateHtmlElementUrl(el, "/console/metrics/field?field=" + el.id);
    }

    function updateHtmlElementUrl(el, url){
        $.ajax({
            dataType: "html",
            url: url,
            type: "GET",
            success: function (data,status,xhr) {   // success callback function
                $(el).html(data);
            },
            error: function (jqXhr, textStatus, errorMessage) { // error callback
                $(el).html("Unavailable");
            }
        });
    }

    updateHtmlElementUrlTimerByIdGlobal("connectorStatus", 2000, "/console/connector/status");

    const field = document.getElementById('searchField');
    const ac = new Autocomplete(field, {
        data: [{label: "", value: ""}],
        maximumItems: 20,
        threshold: 2,
        onSelectItem: ({label, value}) => {
            sessionId = value;
            $.ajax({
                url: "/console/async?page=session.html&clientId=" + sessionId,
                success: function( result ) {
                    $("#dyna").html(result);
                }
            });
            field.value = '';
        },
        onInput: (value) => {
            $.getJSON("/console/search?searchTerm=" + value, function (update){
                // console.log("user input: " + JSON.stringify(update));
                ac.setData(update);
                ac.renderIfNeeded();
            });
        }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="/console/js/script.js"></script>
<script>
    feather.replace();
</script>
</body>
</html>